# pfSense - Guia B√°sico de Instala√ß√£o e Configura√ß√£o

## üì• Download e Requisitos
- pfSense √© baseado em FreeBSD 64 bits.  
- Requisitos m√≠nimos recomendados:  
  - CPU: 2 n√∫cleos  
  - Mem√≥ria RAM: 2GB  
  - Disco: 16GB  
  - Placas de rede: 2 (uma para WAN e outra para LAN)  
- Pode ser instalado em pendrive boot√°vel.

---

## ‚öôÔ∏è Instala√ß√£o
- Na tela inicial:  
  - Selecionar "Install pfSense"  
  - Layout do teclado: Brazilian (com acento)  
- Op√ß√£o de instala√ß√£o autom√°tica com ZFS (n√£o usa RAID, usa Stripe).  
- Selecionar o disco para instala√ß√£o.  
- Ap√≥s instala√ß√£o, remover o disco ISO para evitar rein√≠cio na tela de instala√ß√£o.  
- Se instalou via pendrive, apenas remova o pendrive.

---

## üñ•Ô∏è Configura√ß√£o Inicial via CLI
- Aparecer√° menu com op√ß√µes 0 a 14 para configurar.  
- Principais:  

### 1 - Configurar interfaces  
- Apresenta interfaces pelo MAC address.  
- Defina qual √© WAN e qual √© LAN.

### 2 - Configurar IPs das interfaces  
- WAN:  
  - Se roteador com NAT, configurar como DHCP para pegar IP automaticamente.  
  - Pode definir IP fixo na mesma subrede WAN.  
  - Se modo bridge, atribuir IP p√∫blico direto.  

- LAN:  
  - pfSense atua como roteador e firewall.  
  - Configure IP fixo na LAN (ser√° o IP do firewall).  
  - Ative DHCP para LAN para distribuir IPs internos.

---

## üåê Modo Bridge  
- Caso o roteador esteja em modo Bridge, o pfSense controla tudo.  
- N√£o h√° redes separadas (Wi-Fi e firewall).  
- Basta criar um Access Point na LAN do pfSense.

---

## üñß IPs Fixos para Devices Internos  
- Para servidores, impressoras, c√¢meras IP etc:  
  - Configure IP fixo diretamente nos dispositivos ou  
  - Use DHCP Static Mappings:  
    - V√° em Services -> DHCP Server -> LAN -> Static Mappings  
    - Associe MAC address ao IP fixo desejado.

---

## üåê Interface Web (GUI)
- Acesse pelo IP da LAN configurado no navegador.  
- Login padr√£o:  
  - Usu√°rio: `admin`  
  - Senha: `pfsense`  

### Configura√ß√µes principais
- Hostname: nome do servidor/firewall.  
- Domain: nome do dom√≠nio.  
- DNS: pode usar DNS do AD e DNS secund√°rio, ex: Google DNS.  
- Allow DNS Override: geralmente desativar (para n√£o usar DNS da operadora).  
- Servidor NTP: para sincroniza√ß√£o de hor√°rio, ex: `ntp.br`.  
- Timezone: ex: America/Sao_Paulo ou America/Brasilia.  
- WAN e LAN: deixe padr√£o ou ajuste conforme necess√°rio.  
- Altere a senha do admin.

---

## üìä Dashboard e Plugins
- Plugins permitem visualizar detalhes do firewall, logs, status dos servi√ßos.  
- Exemplo: Wake on LAN, monitoramento de tr√°fego.

---

## üîê Regras (Policies)  
- Por padr√£o, pfSense vem com tudo permitido (any to any).  
- Melhor pr√°tica: desabilitar regra padr√£o (Disable default allow).  
- Criar regras espec√≠ficas para liberar servi√ßos necess√°rios:  
  - DNS: porta 53 (TCP/UDP) para resolver nomes (FQDN).  
  - NTP: porta 123 (UDP) para sincroniza√ß√£o de hor√°rio.  
  - ICMP: liberar echo request e echo reply para ping.  
  - FTP: portas 20 e 21 se necess√°rio.  
- Marque a op√ß√£o para logar essas conex√µes nas regras.

---

## üìù Aliases (Apelidos)
- Para permitir destinos espec√≠ficos, use aliases baseados em FQDNs (Fully Qualified Domain Names).  
- V√° em Aliases -> Add.  
- Pode adicionar m√∫ltiplos FQDNs por servi√ßo para facilitar regras.

---

## üë• Grupos e Usu√°rios
- Instale pacote sudo via Package Manager para comandos administrativos.  
- Configure autentica√ß√£o LDAP para integra√ß√£o com Active Directory:  
  - Hostname do AD  
  - Porta 389 (LDAP padr√£o)  
  - SSL/TLS conforme configura√ß√£o  
  - Search Scope: subtree (busca recursiva em todos os n√≠veis)  
  - Base DN: ex: `DC=empresa,DC=local`  
  - Authentication Containers: local onde usu√°rios est√£o (ex: `CN=Users,DC=empresa,DC=local`)  
  - Bind Credentials: usu√°rio criado no AD para bind LDAP.

---

## üîí Captive Portal
- Configure em Services -> Captive Portal.  
- Defina zone name (ex: LAN).  
- Configure autentica√ß√£o via LDAP com a conta Bind do AD.  
- Permiss√µes para ler usu√°rios s√£o necess√°rias.

---

## üö´ pfBlockerNG  
- Ferramenta para filtragem web e bloqueio por categorias (malware, conte√∫do adulto etc.).

---

## üõ°Ô∏è IPS/IDS com Snort
- Instale o pacote Snort e crie conta para obter chave.  
- V√° em Services -> Snort para configura√ß√£o.  
- Na General Config: baixe atualiza√ß√µes e regras.  
- Configure para bloquear IPs ofensores por 1 hora.  
- Adicione interface (principalmente LAN).  
- Ative IPS, prote√ß√£o e bloqueio de ofensores.  
- Crie alias Home Net para ignorar inspe√ß√£o de tr√°fego local.  
- Use pass list para exce√ß√µes (falsos positivos).  
- Alias suppress autom√°ticos para suprimir alertas espec√≠ficos.  
- Configure categorias para LAN e selecione regras a serem aplicadas.  
- Ajuste regras liberando ou bloqueando conforme falso positivos.

---